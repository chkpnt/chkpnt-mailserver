<?xml version="1.0" ?>
<testsuites disabled="0" errors="0" failures="0" tests="7" time="13.422600269317627">
	<testsuite disabled="0" errors="0" failures="0" name="IMAPLoginWithCorrectCredentialsTest" skipped="0" tests="7" time="13.422600269317627">
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/_prepare/client.yml:5" name="[client] Prepare client: shell _raw_params=&gt; ~/dead.letter" time="0.727258">
			<system-out>{
&quot;ansible_facts&quot;: {
&quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;
},
&quot;changed&quot;: true,
&quot;cmd&quot;: &quot;&gt; ~/dead.letter&quot;,
&quot;delta&quot;: &quot;0:00:00.003354&quot;,
&quot;end&quot;: &quot;2020-04-19 23:41:51.117791&quot;,
&quot;rc&quot;: 0,
&quot;start&quot;: &quot;2020-04-19 23:41:51.114437&quot;,
&quot;stderr&quot;: &quot;&quot;,
&quot;stderr_lines&quot;: [],
&quot;stdout&quot;: &quot;&quot;,
&quot;stdout_lines&quot;: [],
&quot;warnings&quot;: [
&quot;Platform linux on host client is using the discovered Python interpreter at /usr/bin/python, but future installation of another Python interpreter could change this. See https://docs.ansible.com/ansible/2.9/reference_appendices/interpreter_discovery.html for more information.&quot;
]
}</system-out>
		</testcase>
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/_prepare/client.yml:6" name="[client] Prepare client: shell _raw_params=&gt; ~/mail.err" time="0.349508">
			<system-out>{
&quot;changed&quot;: true,
&quot;cmd&quot;: &quot;&gt; ~/mail.err&quot;,
&quot;delta&quot;: &quot;0:00:00.003337&quot;,
&quot;end&quot;: &quot;2020-04-19 23:41:51.481076&quot;,
&quot;rc&quot;: 0,
&quot;start&quot;: &quot;2020-04-19 23:41:51.477739&quot;,
&quot;stderr&quot;: &quot;&quot;,
&quot;stderr_lines&quot;: [],
&quot;stdout&quot;: &quot;&quot;,
&quot;stdout_lines&quot;: []
}</system-out>
		</testcase>
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/_prepare/client.yml:7" name="[client] Prepare client: shell _raw_params=&gt; ~/imap.log" time="0.403586">
			<system-out>{
&quot;changed&quot;: true,
&quot;cmd&quot;: &quot;&gt; ~/imap.log&quot;,
&quot;delta&quot;: &quot;0:00:00.003790&quot;,
&quot;end&quot;: &quot;2020-04-19 23:41:51.861814&quot;,
&quot;rc&quot;: 0,
&quot;start&quot;: &quot;2020-04-19 23:41:51.858024&quot;,
&quot;stderr&quot;: &quot;&quot;,
&quot;stderr_lines&quot;: [],
&quot;stdout&quot;: &quot;&quot;,
&quot;stdout_lines&quot;: []
}</system-out>
		</testcase>
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/_prepare/client.yml:8" name="[client] Prepare client: shell _raw_params=&gt; /var/mail/vagrant" time="0.339032">
			<system-out>{
&quot;changed&quot;: true,
&quot;cmd&quot;: &quot;&gt; /var/mail/vagrant&quot;,
&quot;delta&quot;: &quot;0:00:00.002935&quot;,
&quot;end&quot;: &quot;2020-04-19 23:41:52.236496&quot;,
&quot;rc&quot;: 0,
&quot;start&quot;: &quot;2020-04-19 23:41:52.233561&quot;,
&quot;stderr&quot;: &quot;&quot;,
&quot;stderr_lines&quot;: [],
&quot;stdout&quot;: &quot;&quot;,
&quot;stdout_lines&quot;: []
}</system-out>
		</testcase>
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/fetching/IMAPLoginWithCorrectCredentialsTest.yml:6" name="[client] client: Login to Dovecot as john.doe@mydomain.test with correct password executable=/usr/bin/expect, _raw_params=log_file -noappend imap.log
spawn openssl s_client -crlf -connect sut.mydomain.test:993
expect &quot;\* OK * Dovecot ready.&quot;

send &quot;a001 login john.doe@mydomain.test changeme\r&quot;
expect &quot;a001 OK \[*\] Logged in&quot;

send &quot;a002 logout\r&quot;
expect eof

exit 0
" time="10.511771">
			<system-out>{
&quot;changed&quot;: true,
&quot;cmd&quot;: &quot;log_file -noappend imap.log\nspawn openssl s_client -crlf -connect sut.mydomain.test:993\nexpect \&quot;\\* OK * Dovecot ready.\&quot;\n\nsend \&quot;a001 login john.doe@mydomain.test changeme\\r\&quot;\nexpect \&quot;a001 OK \\[*\\] Logged in\&quot;\n\nsend \&quot;a002 logout\\r\&quot;\nexpect eof\n\nexit 0\n&quot;,
&quot;delta&quot;: &quot;0:00:10.162980&quot;,
&quot;end&quot;: &quot;2020-04-19 23:42:02.744139&quot;,
&quot;rc&quot;: 0,
&quot;start&quot;: &quot;2020-04-19 23:41:52.581159&quot;,
&quot;stderr&quot;: &quot;&quot;,
&quot;stderr_lines&quot;: [],
&quot;stdout&quot;: &quot;spawn openssl s_client -crlf -connect sut.mydomain.test:993\r\nCONNECTED(00000004)\r\ndepth=0 CN = Mailserver\r\nverify error:num=20:unable to get local issuer certificate\r\nverify return:1\r\ndepth=0 CN = Mailserver\r\nverify error:num=21:unable to verify the first certificate\r\nverify return:1\r\n---\r\nCertificate chain\r\n 0 s:/CN=Mailserver\r\n   i:/CN=Mailserver Root CA\r\n---\r\nServer certificate\r\n-----BEGIN CERTIFICATE-----\r\nMIIDBTCCAe2gAwIBAgIJAIEp48qbUdTSMA0GCSqGSIb3DQEBCwUAMB0xGzAZBgNV\r\nBAMMEk1haWxzZXJ2ZXIgUm9vdCBDQTAeFw0yMDA0MTkxNzI5MzRaFw0yMTA0MTkx\r\nNzI5MzRaMBUxEzARBgNVBAMMCk1haWxzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUA\r\nA4IBDwAwggEKAoIBAQC8ydhS2kHbEKAdMM5VzOerEDkq2Z1dTCEmjIm52UCCybHS\r\nGC3cxmUe9v0OZBMxDgd/JKR6VlKfYRSM137mh56SusLmk2damXRKzgK5QBivXJhQ\r\naVWWWTnpr6oLj0tV5Nfj6IPDZYF1BtN9kw2mxRn1+T7BFilEkhzwYD+ZB6NBtezR\r\ngA/nnMYjrmMIc41qXpDt1IuYh6Lno2NAbzHv43oLrIkbEq9/xXptNWgwvpTYFWuQ\r\nnySHVqtQXxQUtmYBj7FWM/bSZ/i+7sBeyzScPCxHO3cvxVgTtSb3jE8P4rmjgpph\r\nnf7tKMj/58ikQze0d+cPgrXHj06aMudjK6fUzqgLAgMBAAGjUDBOMAwGA1UdEwEB\r\n/wQCMAAwCwYDVR0PBAQDAgWgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMBwGA1UdEQQV\r\nMBOCEXN1dC5teWRvbWFpbi50ZXN0MA0GCSqGSIb3DQEBCwUAA4IBAQCBgw3SdsFX\r\npbDbaqt2DOOYYUdhUVn7iIJ8cSILOoBQt6yNQ+++9e+zRBmHtTVZhm1r7JBx7fvJ\r\nQ7dMi/ZrXNEDLUos8jlOS5h1VbKjOnsyCtG3Yi7O59RciFw6mlQm2QCEkJR9fpdA\r\novyAy7tzk6GBha+gFdy3VNor2b0tWAInsMc1Ww6whM5VLsG4Yf6YcNw92RMlLsn8\r\n9/hffhSusQApJ8UkcziHEXObTS+3sGhrtUpM1zB2MgreC7Tn76RpnrqxGY66Zdpo\r\nmD9jSc0vxXyo276pkMtTOtwz5z3JZeIfD/diZ8NDCfK1+5w8LsQLaptOJGYt/8qd\r\nWiS4E54WS674\r\n-----END CERTIFICATE-----\r\nsubject=/CN=Mailserver\r\nissuer=/CN=Mailserver Root CA\r\n---\r\nNo client certificate CA names sent\r\nPeer signing digest: SHA512\r\nServer Temp Key: X25519, 253 bits\r\n---\r\nSSL handshake has read 1402 bytes and written 269 bytes\r\nVerification error: unable to verify the first certificate\r\n---\r\nNew, TLSv1.2, Cipher is ECDHE-RSA-AES256-GCM-SHA384\r\nServer public key is 2048 bit\r\nSecure Renegotiation IS supported\r\nCompression: NONE\r\nExpansion: NONE\r\nNo ALPN negotiated\r\nSSL-Session:\r\n    Protocol  : TLSv1.2\r\n    Cipher    : ECDHE-RSA-AES256-GCM-SHA384\r\n    Session-ID: 9E0D93160A3D6ECDF9544F41FF40F95D45BE397CB4F1E6D9C6B5F4840F8D0448\r\n    Session-ID-ctx: \r\n    Master-Key: 393054418FB30B2CB20C935252B68BFCA487647810AF0F8E296153F9437D9648BF53D85C778650E1E380F4A1EAF87934\r\n    PSK identity: None\r\n    PSK identity hint: None\r\n    SRP username: None\r\n    TLS session ticket lifetime hint: 7200 (seconds)\r\n    TLS session ticket:\r\n    0000 - ec e0 4e bd 07 50 d8 dd-43 fc e7 cd 2f 27 34 8e   ..N..P..C.../'4.\r\n    0010 - 40 b2 a1 9f 7e 82 76 f4-5b db ab 22 16 f5 91 48   @...~.v.[..\&quot;...H\r\n    0020 - 06 a1 2c ee fb cd fb 58-30 bb b2 d2 33 11 ed 1a   ..,....X0...3...\r\n    0030 - 2e cb 62 ac 23 af b6 a2-0d 60 9f e7 f4 82 43 bf   ..b.#....`....C.\r\n    0040 - 0a 5b 9e 67 6b b7 19 68-a0 b3 17 f4 f2 7f e2 4f   .[.gk..h.......O\r\n    0050 - e0 ff 3c 7a df c3 41 b9-ca fb 40 77 28 42 62 aa   ..&lt;z..A...@w(Bb.\r\n    0060 - 2c 8e 37 6d ac ca a9 a1-a5 79 80 a5 de 51 97 82   ,.7m.....y...Q..\r\n    0070 - d6 73 44 ab 80 ed 5d bc-85 c3 1c 42 42 0b 56 e4   .sD...]....BB.V.\r\n    0080 - 37 a4 d4 35 a6 9e b5 63-ab 01 e2 2e 6f ad b8 ad   7..5...c....o...\r\n    0090 - 3d ff aa cc 54 36 3a fc-9d 9c f2 ab 26 f3 9e 1f   =...T6:.....&amp;...\r\n\r\n    Start Time: 1587332512\r\n    Timeout   : 7200 (sec)\r\n    Verify return code: 21 (unable to verify the first certificate)\r\n    Extended master secret: yes\r\n---\r\n* OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LITERAL+ AUTH=PLAIN] Dovecot ready.\ra001 login john.doe@mydomain.test changeme\r\n\r\na001 OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE SORT SORT=DISPLAY THREAD=REFERENCES THREAD=REFS THREAD=ORDEREDSUBJECT MULTIAPPEND URL-PARTIAL CATENATE UNSELECT CHILDREN NAMESPACE UIDPLUS LIST-EXTENDED I18NLEVEL=1 CONDSTORE QRESYNC ESEARCH ESORT SEARCHRES WITHIN CONTEXT=SEARCH LIST-STATUS BINARY MOVE SNIPPET=FUZZY LITERAL+ NOTIFY SPECIAL-USE] Logged in\r\r\na002 logout\r\n* BYE Logging out\r\r\na002 OK Logout completed (0.001 + 0.000 secs).\r\r\nclosed&quot;,
&quot;stdout_lines&quot;: [
&quot;spawn openssl s_client -crlf -connect sut.mydomain.test:993&quot;,
&quot;CONNECTED(00000004)&quot;,
&quot;depth=0 CN = Mailserver&quot;,
&quot;verify error:num=20:unable to get local issuer certificate&quot;,
&quot;verify return:1&quot;,
&quot;depth=0 CN = Mailserver&quot;,
&quot;verify error:num=21:unable to verify the first certificate&quot;,
&quot;verify return:1&quot;,
&quot;---&quot;,
&quot;Certificate chain&quot;,
&quot; 0 s:/CN=Mailserver&quot;,
&quot;   i:/CN=Mailserver Root CA&quot;,
&quot;---&quot;,
&quot;Server certificate&quot;,
&quot;-----BEGIN CERTIFICATE-----&quot;,
&quot;MIIDBTCCAe2gAwIBAgIJAIEp48qbUdTSMA0GCSqGSIb3DQEBCwUAMB0xGzAZBgNV&quot;,
&quot;BAMMEk1haWxzZXJ2ZXIgUm9vdCBDQTAeFw0yMDA0MTkxNzI5MzRaFw0yMTA0MTkx&quot;,
&quot;NzI5MzRaMBUxEzARBgNVBAMMCk1haWxzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUA&quot;,
&quot;A4IBDwAwggEKAoIBAQC8ydhS2kHbEKAdMM5VzOerEDkq2Z1dTCEmjIm52UCCybHS&quot;,
&quot;GC3cxmUe9v0OZBMxDgd/JKR6VlKfYRSM137mh56SusLmk2damXRKzgK5QBivXJhQ&quot;,
&quot;aVWWWTnpr6oLj0tV5Nfj6IPDZYF1BtN9kw2mxRn1+T7BFilEkhzwYD+ZB6NBtezR&quot;,
&quot;gA/nnMYjrmMIc41qXpDt1IuYh6Lno2NAbzHv43oLrIkbEq9/xXptNWgwvpTYFWuQ&quot;,
&quot;nySHVqtQXxQUtmYBj7FWM/bSZ/i+7sBeyzScPCxHO3cvxVgTtSb3jE8P4rmjgpph&quot;,
&quot;nf7tKMj/58ikQze0d+cPgrXHj06aMudjK6fUzqgLAgMBAAGjUDBOMAwGA1UdEwEB&quot;,
&quot;/wQCMAAwCwYDVR0PBAQDAgWgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMBwGA1UdEQQV&quot;,
&quot;MBOCEXN1dC5teWRvbWFpbi50ZXN0MA0GCSqGSIb3DQEBCwUAA4IBAQCBgw3SdsFX&quot;,
&quot;pbDbaqt2DOOYYUdhUVn7iIJ8cSILOoBQt6yNQ+++9e+zRBmHtTVZhm1r7JBx7fvJ&quot;,
&quot;Q7dMi/ZrXNEDLUos8jlOS5h1VbKjOnsyCtG3Yi7O59RciFw6mlQm2QCEkJR9fpdA&quot;,
&quot;ovyAy7tzk6GBha+gFdy3VNor2b0tWAInsMc1Ww6whM5VLsG4Yf6YcNw92RMlLsn8&quot;,
&quot;9/hffhSusQApJ8UkcziHEXObTS+3sGhrtUpM1zB2MgreC7Tn76RpnrqxGY66Zdpo&quot;,
&quot;mD9jSc0vxXyo276pkMtTOtwz5z3JZeIfD/diZ8NDCfK1+5w8LsQLaptOJGYt/8qd&quot;,
&quot;WiS4E54WS674&quot;,
&quot;-----END CERTIFICATE-----&quot;,
&quot;subject=/CN=Mailserver&quot;,
&quot;issuer=/CN=Mailserver Root CA&quot;,
&quot;---&quot;,
&quot;No client certificate CA names sent&quot;,
&quot;Peer signing digest: SHA512&quot;,
&quot;Server Temp Key: X25519, 253 bits&quot;,
&quot;---&quot;,
&quot;SSL handshake has read 1402 bytes and written 269 bytes&quot;,
&quot;Verification error: unable to verify the first certificate&quot;,
&quot;---&quot;,
&quot;New, TLSv1.2, Cipher is ECDHE-RSA-AES256-GCM-SHA384&quot;,
&quot;Server public key is 2048 bit&quot;,
&quot;Secure Renegotiation IS supported&quot;,
&quot;Compression: NONE&quot;,
&quot;Expansion: NONE&quot;,
&quot;No ALPN negotiated&quot;,
&quot;SSL-Session:&quot;,
&quot;    Protocol  : TLSv1.2&quot;,
&quot;    Cipher    : ECDHE-RSA-AES256-GCM-SHA384&quot;,
&quot;    Session-ID: 9E0D93160A3D6ECDF9544F41FF40F95D45BE397CB4F1E6D9C6B5F4840F8D0448&quot;,
&quot;    Session-ID-ctx: &quot;,
&quot;    Master-Key: 393054418FB30B2CB20C935252B68BFCA487647810AF0F8E296153F9437D9648BF53D85C778650E1E380F4A1EAF87934&quot;,
&quot;    PSK identity: None&quot;,
&quot;    PSK identity hint: None&quot;,
&quot;    SRP username: None&quot;,
&quot;    TLS session ticket lifetime hint: 7200 (seconds)&quot;,
&quot;    TLS session ticket:&quot;,
&quot;    0000 - ec e0 4e bd 07 50 d8 dd-43 fc e7 cd 2f 27 34 8e   ..N..P..C.../'4.&quot;,
&quot;    0010 - 40 b2 a1 9f 7e 82 76 f4-5b db ab 22 16 f5 91 48   @...~.v.[..\&quot;...H&quot;,
&quot;    0020 - 06 a1 2c ee fb cd fb 58-30 bb b2 d2 33 11 ed 1a   ..,....X0...3...&quot;,
&quot;    0030 - 2e cb 62 ac 23 af b6 a2-0d 60 9f e7 f4 82 43 bf   ..b.#....`....C.&quot;,
&quot;    0040 - 0a 5b 9e 67 6b b7 19 68-a0 b3 17 f4 f2 7f e2 4f   .[.gk..h.......O&quot;,
&quot;    0050 - e0 ff 3c 7a df c3 41 b9-ca fb 40 77 28 42 62 aa   ..&lt;z..A...@w(Bb.&quot;,
&quot;    0060 - 2c 8e 37 6d ac ca a9 a1-a5 79 80 a5 de 51 97 82   ,.7m.....y...Q..&quot;,
&quot;    0070 - d6 73 44 ab 80 ed 5d bc-85 c3 1c 42 42 0b 56 e4   .sD...]....BB.V.&quot;,
&quot;    0080 - 37 a4 d4 35 a6 9e b5 63-ab 01 e2 2e 6f ad b8 ad   7..5...c....o...&quot;,
&quot;    0090 - 3d ff aa cc 54 36 3a fc-9d 9c f2 ab 26 f3 9e 1f   =...T6:.....&amp;...&quot;,
&quot;&quot;,
&quot;    Start Time: 1587332512&quot;,
&quot;    Timeout   : 7200 (sec)&quot;,
&quot;    Verify return code: 21 (unable to verify the first certificate)&quot;,
&quot;    Extended master secret: yes&quot;,
&quot;---&quot;,
&quot;* OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LITERAL+ AUTH=PLAIN] Dovecot ready.&quot;,
&quot;a001 login john.doe@mydomain.test changeme&quot;,
&quot;&quot;,
&quot;a001 OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE SORT SORT=DISPLAY THREAD=REFERENCES THREAD=REFS THREAD=ORDEREDSUBJECT MULTIAPPEND URL-PARTIAL CATENATE UNSELECT CHILDREN NAMESPACE UIDPLUS LIST-EXTENDED I18NLEVEL=1 CONDSTORE QRESYNC ESEARCH ESORT SEARCHRES WITHIN CONTEXT=SEARCH LIST-STATUS BINARY MOVE SNIPPET=FUZZY LITERAL+ NOTIFY SPECIAL-USE] Logged in&quot;,
&quot;&quot;,
&quot;a002 logout&quot;,
&quot;* BYE Logging out&quot;,
&quot;&quot;,
&quot;a002 OK Logout completed (0.001 + 0.000 secs).&quot;,
&quot;&quot;,
&quot;closed&quot;
]
}</system-out>
		</testcase>
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/fetching/IMAPLoginWithCorrectCredentialsTest.yml:21" name="[client] client: Clean up imap.log path=imap.log, regexp=^([^
]*)
+$, replace=\1" time="0.528343">
			<system-out>{
&quot;changed&quot;: true,
&quot;msg&quot;: &quot;82 replacements made&quot;
}</system-out>
		</testcase>
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/fetching/IMAPLoginWithCorrectCredentialsTest.yml:26" name="[client] client: Assert imap login succeeded file=imap.log, with_content=spawn openssl s_client -crlf -connect sut.mydomain.test:993
...
* OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LITERAL+ AUTH=PLAIN] Dovecot ready.
a001 login john.doe@mydomain.test changeme

a001 OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE SORT SORT=DISPLAY THREAD=REFERENCES THREAD=REFS THREAD=ORDEREDSUBJECT MULTIAPPEND URL-PARTIAL CATENATE UNSELECT CHILDREN NAMESPACE UIDPLUS LIST-EXTENDED I18NLEVEL=1 CONDSTORE QRESYNC ESEARCH ESORT SEARCHRES WITHIN CONTEXT=SEARCH LIST-STATUS BINARY MOVE SNIPPET=FUZZY LITERAL+ NOTIFY SPECIAL-USE] Logged in
a002 logout
* BYE Logging out
a002 OK Logout completed (0.001 + 0.000 secs).
closed" time="0.563102">
			<system-out>{
&quot;changed&quot;: false,
&quot;meta&quot;: []
}</system-out>
		</testcase>
	</testsuite>
</testsuites>
