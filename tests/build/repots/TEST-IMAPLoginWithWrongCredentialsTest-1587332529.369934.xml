<?xml version="1.0" ?>
<testsuites disabled="0" errors="0" failures="0" tests="7" time="4.704697370529175">
	<testsuite disabled="0" errors="0" failures="0" name="IMAPLoginWithWrongCredentialsTest" skipped="0" tests="7" time="4.704697370529175">
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/_prepare/client.yml:5" name="[client] Prepare client: shell _raw_params=&gt; ~/dead.letter" time="0.620007">
			<system-out>{
&quot;ansible_facts&quot;: {
&quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;
},
&quot;changed&quot;: true,
&quot;cmd&quot;: &quot;&gt; ~/dead.letter&quot;,
&quot;delta&quot;: &quot;0:00:00.002935&quot;,
&quot;end&quot;: &quot;2020-04-19 23:42:05.193348&quot;,
&quot;rc&quot;: 0,
&quot;start&quot;: &quot;2020-04-19 23:42:05.190413&quot;,
&quot;stderr&quot;: &quot;&quot;,
&quot;stderr_lines&quot;: [],
&quot;stdout&quot;: &quot;&quot;,
&quot;stdout_lines&quot;: [],
&quot;warnings&quot;: [
&quot;Platform linux on host client is using the discovered Python interpreter at /usr/bin/python, but future installation of another Python interpreter could change this. See https://docs.ansible.com/ansible/2.9/reference_appendices/interpreter_discovery.html for more information.&quot;
]
}</system-out>
		</testcase>
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/_prepare/client.yml:6" name="[client] Prepare client: shell _raw_params=&gt; ~/mail.err" time="0.352322">
			<system-out>{
&quot;changed&quot;: true,
&quot;cmd&quot;: &quot;&gt; ~/mail.err&quot;,
&quot;delta&quot;: &quot;0:00:00.003246&quot;,
&quot;end&quot;: &quot;2020-04-19 23:42:05.553079&quot;,
&quot;rc&quot;: 0,
&quot;start&quot;: &quot;2020-04-19 23:42:05.549833&quot;,
&quot;stderr&quot;: &quot;&quot;,
&quot;stderr_lines&quot;: [],
&quot;stdout&quot;: &quot;&quot;,
&quot;stdout_lines&quot;: []
}</system-out>
		</testcase>
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/_prepare/client.yml:7" name="[client] Prepare client: shell _raw_params=&gt; ~/imap.log" time="0.360526">
			<system-out>{
&quot;changed&quot;: true,
&quot;cmd&quot;: &quot;&gt; ~/imap.log&quot;,
&quot;delta&quot;: &quot;0:00:00.002924&quot;,
&quot;end&quot;: &quot;2020-04-19 23:42:05.914488&quot;,
&quot;rc&quot;: 0,
&quot;start&quot;: &quot;2020-04-19 23:42:05.911564&quot;,
&quot;stderr&quot;: &quot;&quot;,
&quot;stderr_lines&quot;: [],
&quot;stdout&quot;: &quot;&quot;,
&quot;stdout_lines&quot;: []
}</system-out>
		</testcase>
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/_prepare/client.yml:8" name="[client] Prepare client: shell _raw_params=&gt; /var/mail/vagrant" time="0.373137">
			<system-out>{
&quot;changed&quot;: true,
&quot;cmd&quot;: &quot;&gt; /var/mail/vagrant&quot;,
&quot;delta&quot;: &quot;0:00:00.003177&quot;,
&quot;end&quot;: &quot;2020-04-19 23:42:06.294504&quot;,
&quot;rc&quot;: 0,
&quot;start&quot;: &quot;2020-04-19 23:42:06.291327&quot;,
&quot;stderr&quot;: &quot;&quot;,
&quot;stderr_lines&quot;: [],
&quot;stdout&quot;: &quot;&quot;,
&quot;stdout_lines&quot;: []
}</system-out>
		</testcase>
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/fetching/IMAPLoginWithWrongCredentialsTest.yml:6" name="[client] client: Login to Dovecot as john.doe@mydomain.test with wrong password executable=/usr/bin/expect, _raw_params=log_file -noappend imap.log
spawn openssl s_client -crlf -connect sut.mydomain.test:993
expect &quot;\* OK * Dovecot ready.&quot;

send &quot;a001 login john.doe@mydomain.test wrong_password\r&quot;
expect -exact &quot;a001 NO \[AUTHENTICATIONFAILED\] Authentication failed.&quot;

send &quot;a002 logout\r&quot;
expect eof

exit 0
" time="2.015155">
			<system-out>{
&quot;changed&quot;: true,
&quot;cmd&quot;: &quot;log_file -noappend imap.log\nspawn openssl s_client -crlf -connect sut.mydomain.test:993\nexpect \&quot;\\* OK * Dovecot ready.\&quot;\n\nsend \&quot;a001 login john.doe@mydomain.test wrong_password\\r\&quot;\nexpect -exact \&quot;a001 NO \\[AUTHENTICATIONFAILED\\] Authentication failed.\&quot;\n\nsend \&quot;a002 logout\\r\&quot;\nexpect eof\n\nexit 0\n&quot;,
&quot;delta&quot;: &quot;0:00:01.658575&quot;,
&quot;end&quot;: &quot;2020-04-19 23:42:08.310241&quot;,
&quot;rc&quot;: 0,
&quot;start&quot;: &quot;2020-04-19 23:42:06.651666&quot;,
&quot;stderr&quot;: &quot;&quot;,
&quot;stderr_lines&quot;: [],
&quot;stdout&quot;: &quot;spawn openssl s_client -crlf -connect sut.mydomain.test:993\r\nCONNECTED(00000004)\r\ndepth=0 CN = Mailserver\r\nverify error:num=20:unable to get local issuer certificate\r\nverify return:1\r\ndepth=0 CN = Mailserver\r\nverify error:num=21:unable to verify the first certificate\r\nverify return:1\r\n---\r\nCertificate chain\r\n 0 s:/CN=Mailserver\r\n   i:/CN=Mailserver Root CA\r\n---\r\nServer certificate\r\n-----BEGIN CERTIFICATE-----\r\nMIIDBTCCAe2gAwIBAgIJAIEp48qbUdTSMA0GCSqGSIb3DQEBCwUAMB0xGzAZBgNV\r\nBAMMEk1haWxzZXJ2ZXIgUm9vdCBDQTAeFw0yMDA0MTkxNzI5MzRaFw0yMTA0MTkx\r\nNzI5MzRaMBUxEzARBgNVBAMMCk1haWxzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUA\r\nA4IBDwAwggEKAoIBAQC8ydhS2kHbEKAdMM5VzOerEDkq2Z1dTCEmjIm52UCCybHS\r\nGC3cxmUe9v0OZBMxDgd/JKR6VlKfYRSM137mh56SusLmk2damXRKzgK5QBivXJhQ\r\naVWWWTnpr6oLj0tV5Nfj6IPDZYF1BtN9kw2mxRn1+T7BFilEkhzwYD+ZB6NBtezR\r\ngA/nnMYjrmMIc41qXpDt1IuYh6Lno2NAbzHv43oLrIkbEq9/xXptNWgwvpTYFWuQ\r\nnySHVqtQXxQUtmYBj7FWM/bSZ/i+7sBeyzScPCxHO3cvxVgTtSb3jE8P4rmjgpph\r\nnf7tKMj/58ikQze0d+cPgrXHj06aMudjK6fUzqgLAgMBAAGjUDBOMAwGA1UdEwEB\r\n/wQCMAAwCwYDVR0PBAQDAgWgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMBwGA1UdEQQV\r\nMBOCEXN1dC5teWRvbWFpbi50ZXN0MA0GCSqGSIb3DQEBCwUAA4IBAQCBgw3SdsFX\r\npbDbaqt2DOOYYUdhUVn7iIJ8cSILOoBQt6yNQ+++9e+zRBmHtTVZhm1r7JBx7fvJ\r\nQ7dMi/ZrXNEDLUos8jlOS5h1VbKjOnsyCtG3Yi7O59RciFw6mlQm2QCEkJR9fpdA\r\novyAy7tzk6GBha+gFdy3VNor2b0tWAInsMc1Ww6whM5VLsG4Yf6YcNw92RMlLsn8\r\n9/hffhSusQApJ8UkcziHEXObTS+3sGhrtUpM1zB2MgreC7Tn76RpnrqxGY66Zdpo\r\nmD9jSc0vxXyo276pkMtTOtwz5z3JZeIfD/diZ8NDCfK1+5w8LsQLaptOJGYt/8qd\r\nWiS4E54WS674\r\n-----END CERTIFICATE-----\r\nsubject=/CN=Mailserver\r\nissuer=/CN=Mailserver Root CA\r\n---\r\nNo client certificate CA names sent\r\nPeer signing digest: SHA512\r\nServer Temp Key: X25519, 253 bits\r\n---\r\nSSL handshake has read 1402 bytes and written 269 bytes\r\nVerification error: unable to verify the first certificate\r\n---\r\nNew, TLSv1.2, Cipher is ECDHE-RSA-AES256-GCM-SHA384\r\nServer public key is 2048 bit\r\nSecure Renegotiation IS supported\r\nCompression: NONE\r\nExpansion: NONE\r\nNo ALPN negotiated\r\nSSL-Session:\r\n    Protocol  : TLSv1.2\r\n    Cipher    : ECDHE-RSA-AES256-GCM-SHA384\r\n    Session-ID: 757965FA9D2AC07C4D47C0853430F77AF782B2E111922C3BAD128B1818F41484\r\n    Session-ID-ctx: \r\n    Master-Key: 78AD7643675CB8115972A0B9F1805264B094AA0925B7A47ED46D2F9A70B567F5D3D7C436137C00C0895349A0117B65B0\r\n    PSK identity: None\r\n    PSK identity hint: None\r\n    SRP username: None\r\n    TLS session ticket lifetime hint: 7200 (seconds)\r\n    TLS session ticket:\r\n    0000 - a0 bf 27 67 06 0c d8 6a-9f dd 5d 85 51 12 93 35   ..'g...j..].Q..5\r\n    0010 - 32 9f c1 88 24 36 ee f7-fd 31 70 8f 7c 09 58 35   2...$6...1p.|.X5\r\n    0020 - 54 0a 2a fe a3 b1 56 ca-c3 7f cb 5d 60 f5 61 e3   T.*...V....]`.a.\r\n    0030 - 46 12 03 0f a0 ff 85 92-5f f1 f0 9e 19 80 d7 57   F......._......W\r\n    0040 - af 25 9c ec db 74 75 34-e6 4e fd 0c fe 82 c5 56   .%...tu4.N.....V\r\n    0050 - 30 bc b9 f3 7b 21 e7 a9-b3 4a 1f 29 b7 ed 12 b2   0...{!...J.)....\r\n    0060 - d4 0f 77 a7 72 52 07 4b-db a5 27 43 e8 7e d9 a5   ..w.rR.K..'C.~..\r\n    0070 - 4e 2e 58 8c 49 fa 15 46-23 93 2e 38 48 10 c0 10   N.X.I..F#..8H...\r\n    0080 - b0 62 84 e6 e4 ac a4 c2-40 b6 96 d9 6e da ec e6   .b......@...n...\r\n    0090 - c7 59 8f 19 1d 0b 1c fd-45 37 54 bd cf 29 69 3a   .Y......E7T..)i:\r\n\r\n    Start Time: 1587332526\r\n    Timeout   : 7200 (sec)\r\n    Verify return code: 21 (unable to verify the first certificate)\r\n    Extended master secret: yes\r\n---\r\n* OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LITERAL+ AUTH=PLAIN] Dovecot ready.\ra001 login john.doe@mydomain.test wrong_password\r\n\r\na001 NO [AUTHENTICATIONFAILED] Authentication failed.\ra002 logout\r\n\r\n* BYE Logging out\r\r\na002 OK Logout completed.\r\r\nclosed&quot;,
&quot;stdout_lines&quot;: [
&quot;spawn openssl s_client -crlf -connect sut.mydomain.test:993&quot;,
&quot;CONNECTED(00000004)&quot;,
&quot;depth=0 CN = Mailserver&quot;,
&quot;verify error:num=20:unable to get local issuer certificate&quot;,
&quot;verify return:1&quot;,
&quot;depth=0 CN = Mailserver&quot;,
&quot;verify error:num=21:unable to verify the first certificate&quot;,
&quot;verify return:1&quot;,
&quot;---&quot;,
&quot;Certificate chain&quot;,
&quot; 0 s:/CN=Mailserver&quot;,
&quot;   i:/CN=Mailserver Root CA&quot;,
&quot;---&quot;,
&quot;Server certificate&quot;,
&quot;-----BEGIN CERTIFICATE-----&quot;,
&quot;MIIDBTCCAe2gAwIBAgIJAIEp48qbUdTSMA0GCSqGSIb3DQEBCwUAMB0xGzAZBgNV&quot;,
&quot;BAMMEk1haWxzZXJ2ZXIgUm9vdCBDQTAeFw0yMDA0MTkxNzI5MzRaFw0yMTA0MTkx&quot;,
&quot;NzI5MzRaMBUxEzARBgNVBAMMCk1haWxzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUA&quot;,
&quot;A4IBDwAwggEKAoIBAQC8ydhS2kHbEKAdMM5VzOerEDkq2Z1dTCEmjIm52UCCybHS&quot;,
&quot;GC3cxmUe9v0OZBMxDgd/JKR6VlKfYRSM137mh56SusLmk2damXRKzgK5QBivXJhQ&quot;,
&quot;aVWWWTnpr6oLj0tV5Nfj6IPDZYF1BtN9kw2mxRn1+T7BFilEkhzwYD+ZB6NBtezR&quot;,
&quot;gA/nnMYjrmMIc41qXpDt1IuYh6Lno2NAbzHv43oLrIkbEq9/xXptNWgwvpTYFWuQ&quot;,
&quot;nySHVqtQXxQUtmYBj7FWM/bSZ/i+7sBeyzScPCxHO3cvxVgTtSb3jE8P4rmjgpph&quot;,
&quot;nf7tKMj/58ikQze0d+cPgrXHj06aMudjK6fUzqgLAgMBAAGjUDBOMAwGA1UdEwEB&quot;,
&quot;/wQCMAAwCwYDVR0PBAQDAgWgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMBwGA1UdEQQV&quot;,
&quot;MBOCEXN1dC5teWRvbWFpbi50ZXN0MA0GCSqGSIb3DQEBCwUAA4IBAQCBgw3SdsFX&quot;,
&quot;pbDbaqt2DOOYYUdhUVn7iIJ8cSILOoBQt6yNQ+++9e+zRBmHtTVZhm1r7JBx7fvJ&quot;,
&quot;Q7dMi/ZrXNEDLUos8jlOS5h1VbKjOnsyCtG3Yi7O59RciFw6mlQm2QCEkJR9fpdA&quot;,
&quot;ovyAy7tzk6GBha+gFdy3VNor2b0tWAInsMc1Ww6whM5VLsG4Yf6YcNw92RMlLsn8&quot;,
&quot;9/hffhSusQApJ8UkcziHEXObTS+3sGhrtUpM1zB2MgreC7Tn76RpnrqxGY66Zdpo&quot;,
&quot;mD9jSc0vxXyo276pkMtTOtwz5z3JZeIfD/diZ8NDCfK1+5w8LsQLaptOJGYt/8qd&quot;,
&quot;WiS4E54WS674&quot;,
&quot;-----END CERTIFICATE-----&quot;,
&quot;subject=/CN=Mailserver&quot;,
&quot;issuer=/CN=Mailserver Root CA&quot;,
&quot;---&quot;,
&quot;No client certificate CA names sent&quot;,
&quot;Peer signing digest: SHA512&quot;,
&quot;Server Temp Key: X25519, 253 bits&quot;,
&quot;---&quot;,
&quot;SSL handshake has read 1402 bytes and written 269 bytes&quot;,
&quot;Verification error: unable to verify the first certificate&quot;,
&quot;---&quot;,
&quot;New, TLSv1.2, Cipher is ECDHE-RSA-AES256-GCM-SHA384&quot;,
&quot;Server public key is 2048 bit&quot;,
&quot;Secure Renegotiation IS supported&quot;,
&quot;Compression: NONE&quot;,
&quot;Expansion: NONE&quot;,
&quot;No ALPN negotiated&quot;,
&quot;SSL-Session:&quot;,
&quot;    Protocol  : TLSv1.2&quot;,
&quot;    Cipher    : ECDHE-RSA-AES256-GCM-SHA384&quot;,
&quot;    Session-ID: 757965FA9D2AC07C4D47C0853430F77AF782B2E111922C3BAD128B1818F41484&quot;,
&quot;    Session-ID-ctx: &quot;,
&quot;    Master-Key: 78AD7643675CB8115972A0B9F1805264B094AA0925B7A47ED46D2F9A70B567F5D3D7C436137C00C0895349A0117B65B0&quot;,
&quot;    PSK identity: None&quot;,
&quot;    PSK identity hint: None&quot;,
&quot;    SRP username: None&quot;,
&quot;    TLS session ticket lifetime hint: 7200 (seconds)&quot;,
&quot;    TLS session ticket:&quot;,
&quot;    0000 - a0 bf 27 67 06 0c d8 6a-9f dd 5d 85 51 12 93 35   ..'g...j..].Q..5&quot;,
&quot;    0010 - 32 9f c1 88 24 36 ee f7-fd 31 70 8f 7c 09 58 35   2...$6...1p.|.X5&quot;,
&quot;    0020 - 54 0a 2a fe a3 b1 56 ca-c3 7f cb 5d 60 f5 61 e3   T.*...V....]`.a.&quot;,
&quot;    0030 - 46 12 03 0f a0 ff 85 92-5f f1 f0 9e 19 80 d7 57   F......._......W&quot;,
&quot;    0040 - af 25 9c ec db 74 75 34-e6 4e fd 0c fe 82 c5 56   .%...tu4.N.....V&quot;,
&quot;    0050 - 30 bc b9 f3 7b 21 e7 a9-b3 4a 1f 29 b7 ed 12 b2   0...{!...J.)....&quot;,
&quot;    0060 - d4 0f 77 a7 72 52 07 4b-db a5 27 43 e8 7e d9 a5   ..w.rR.K..'C.~..&quot;,
&quot;    0070 - 4e 2e 58 8c 49 fa 15 46-23 93 2e 38 48 10 c0 10   N.X.I..F#..8H...&quot;,
&quot;    0080 - b0 62 84 e6 e4 ac a4 c2-40 b6 96 d9 6e da ec e6   .b......@...n...&quot;,
&quot;    0090 - c7 59 8f 19 1d 0b 1c fd-45 37 54 bd cf 29 69 3a   .Y......E7T..)i:&quot;,
&quot;&quot;,
&quot;    Start Time: 1587332526&quot;,
&quot;    Timeout   : 7200 (sec)&quot;,
&quot;    Verify return code: 21 (unable to verify the first certificate)&quot;,
&quot;    Extended master secret: yes&quot;,
&quot;---&quot;,
&quot;* OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LITERAL+ AUTH=PLAIN] Dovecot ready.&quot;,
&quot;a001 login john.doe@mydomain.test wrong_password&quot;,
&quot;&quot;,
&quot;a001 NO [AUTHENTICATIONFAILED] Authentication failed.&quot;,
&quot;a002 logout&quot;,
&quot;&quot;,
&quot;* BYE Logging out&quot;,
&quot;&quot;,
&quot;a002 OK Logout completed.&quot;,
&quot;&quot;,
&quot;closed&quot;
]
}</system-out>
		</testcase>
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/fetching/IMAPLoginWithWrongCredentialsTest.yml:21" name="[client] client: Clean up imap.log path=imap.log, regexp=^([^
]*)
+$, replace=\1" time="0.480723">
			<system-out>{
&quot;changed&quot;: true,
&quot;msg&quot;: &quot;81 replacements made&quot;
}</system-out>
		</testcase>
		<testcase classname="/Users/ich/repos/chkpnt-mailserver/tests/tests/fetching/IMAPLoginWithWrongCredentialsTest.yml:26" name="[client] client: Assert imap login failed file=imap.log, with_content=spawn openssl s_client -crlf -connect sut.mydomain.test:993
...
* OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LITERAL+ AUTH=PLAIN] Dovecot ready.
a001 login john.doe@mydomain.test wrong_password

a001 NO [AUTHENTICATIONFAILED] Authentication failed.
a002 logout

* BYE Logging out
a002 OK Logout completed.
closed" time="0.502827">
			<system-out>{
&quot;changed&quot;: false,
&quot;meta&quot;: []
}</system-out>
		</testcase>
	</testsuite>
</testsuites>
